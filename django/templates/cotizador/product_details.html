{% extends "cotizador/base_catalog.html" %}

{% block title %}{{ product }} - {{ site_name }}{% endblock %}

{% block catalog_header_content %}
    <link href="/media/css/galleria.css" rel="stylesheet" type="text/css" media="screen" /> 
    <script type="text/javascript" src="/media/js/galleria/jquery.galleria.js"></script>
    <script type="text/javascript"> 
        $(function() {
            $('ul.gallery').galleria({
			    history   : false, 
			    clickNext : false, 
			    insert    : '#image_container',
			    onImage   : undefined,
			    onThumb   : function() { $('ul.gallery img:first').click() },
		    });
		    
		    product_id = {{ product.id }}

        }); 
    </script>
{% endblock %}

{% block catalog_content %}

<div class="product_details_sidebar">
    <div class="product_details_images">
        <div id="image_container"></div>
        <ul class="gallery">
            <li>{{ product.picture.extra_thumbnails_tag.large }}</li>
            {% for picture in product.productpicture_set.all %}
                <li>{{ picture.picture.extra_thumbnails_tag.large }}</li>
            {% endfor %}
            <li><img src="/media/pics/charts/{{ product.id }}.png" alt="Grafico cambios de precio"/></li>
        </ul>
    </div>
    <br class="clear" />
    <div class="price_table_container">
        <table id="mytable" class="table_product_detail_prices">
            <tr>
                <th>Tienda</th>
                <th>Precio</th>
            </tr>
            {% ifequal product_prices|length 0 %}
              <tr>
                <td colspan="2" class="product_availability_message">
                  Este producto no está disponible actualmente
                </td>
              </tr>
            {% else %}
              {% for product_price in product_prices %}
                  <tr>
                      <td>
                          <a href="/store_product/{{product_price.shpe.id}}">{{ product_price.store.picture.thumbnail_tag }}</a>
                      </td>
                      <td>
                          <a href="/store_product/{{product_price.shpe.id}}">{{ product_price.shpe.pretty_price }}</a>
                      </td>
                  </tr>
              {% endfor %}
            {% endifequal %}
        </table>
    </div>
    
    <div id="price_suggestion_box">
        {% if not subscription %}
        <table id="mytable">
            <tr>
                <td>
                    <a href="" class="subscribe_link">
                    <img src="/media/assets/subscribe-icon.png" />
                    </a>
                </td>
                <td>
                    <a href="" class="subscribe_link">
                    {% if product.is_available %}
                        Enviarme cambios de precio
                    {% else %}
                        Avisarme cuando esté disponible
                    {% endif %}
                    </a>
                </td>                
            </tr>
            <tr>
                <td>
                    <a href="" class="favorite_link">
                    <img src="/media/assets/favorite-icon.png" />
                    </a>
                </td>
                <td>
                    <a href="" class="favorite_link">
                    Agregar a mis favoritos
                    </a>
                </td>                
            </tr>            
        </table>
        {% else %}
            {% if subscription.email_notifications %}
                <table id="mytable">
                    <tr>
                        <td>
                            <img src="/media/assets/subscribe-icon.png" />
                        </td>
                        <td>
                            {% if product.is_available %}
                                Estás recibiendo los cambios de precio
                            {% else %}
                                Te avisaremos cuando esté disponible
                            {% endif %}
                        </td>                
                    </tr>
                    <tr>
                        <td>
                            <img src="/media/assets/favorite-icon.png" />
                        </td>
                        <td>
                            Este producto está en tus favoritos
                        </td>                
                    </tr>                         
                </table>            
            {% else %}
                <table>
                    <tr>
                        <td>
                            <a href="" class="subscribe_link">
                            <img src="/media/assets/subscribe-icon.png" />
                            </a>
                        </td>
                        <td>
                            <a href="" class="subscribe_link">
                            {% if product.is_available %}
                                Enviarme cambios de precio
                            {% else %}
                                Avisarme cuando esté disponible
                            {% endif %}
                            </a>
                        </td>                
                    </tr>
                    <tr>
                        <td>
                            <img src="/media/assets/favorite-icon.png" />
                        </td>
                        <td>
                            Este producto está en tus favoritos
                        </td>                
                    </tr>                         
                </table>
            {% endif %}
        {% endif %}
    </div>

    <div class="similar_products">
        <h3>{{ ptype.indexname }} similares</h3>
        {% for ntbk in similar_products %}
            {{ ntbk.render_similar }}
        {% endfor %}
    </div>
</div>
<div class="product_details_specs">
    {{ product.render_details }}
    
    <br />
    <hr class="product_details_comment_separator" />
    <div id="product_comments">
    <h3>Comentarios</h3>
    {% ifequal product_comments.count 0 %}
        No hay comentarios para este producto
    {% else %}
        {% for comment in product_comments %}
            <div class="notebok_comment">
                <span class="comment_nickname">
                    {% if comment.user %}
                        {{ comment.user.username}}
                    {% else %}
                        {{ comment.nickname }}
                    {% endif %}
                </span>
                <span class="comment_date">{{ comment.date }}</span>
                <div class="comment_body">
                {{ comment.comments|safe }}
                </div>
                {% if user.is_staff %}
                    <small><a href="/manager/delete/{{ comment.id }}">Eliminar</a></small>
                {% endif %}
                <hr class="product_details_comment_separator" />
            </div>
        {% endfor %}
    {% endifequal %}
    </div>
    <div id="product_comment_add">
    {% if posted_comment %}
    <strong>Gracias por tus comentarios, dentro de unos minutos será publicado. Recuerda que <a href="#" class="register_link">si te registras</a> tus próximos mensajes aparecerán inmediatamente.</strong>
    {% else %}
        ¿Preguntas, comentarios o sugerencias de este producto? Deja tu mensaje!
        <form action="" id="comment_form" method="post">
            <div>
                <span class="comment_form_label">Nombre:</span>
                {% if user.is_authenticated %}
                    {{ user.username }}
                {% else %}
                    {{ comment_form.nickname }}
                {% endif %}
                <p>
                    <span class="comment_form_label">Comentarios:</span>
                    <br />
                    {{ comment_form.comments }}
                    <br />
                </p>
                <input type="submit" value="Enviar" />
            </div>
        </form>
    {% endif %}
    </div>
</div>
{% endblock %}
